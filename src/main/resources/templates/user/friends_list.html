<!doctype html>
<html
        lang="ko"
        xmlns:th="http://www.thymeleaf.org"
>
<head th:insert="~{fragment/topMenu.html::header}">
    <!-- 반응형 웹 미디어쿼리 선언부   -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

</head>

<body class="p-3 m-0 border-0 bd-example mainBody">
<header th:insert="~{fragment/topMenu.html::nav}"></header>

<table class="table table-hover" th:each="friend:${friendsmemberList  }">
    <thead>
    <tr>
        <th scope="col">ID</th>
        <th scope="col">날짜</th>
        <th scope="col">삭제여부</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <th scope="row" th:text="${friend.friendsNickname }"></th>
        <td th:text="${friend.friendsDate }"></td>
        <td><button type="button" class="btn btn-warning">삭제</button></td>
    </tr>
    </tbody>
</table>

<button type="button" class="btn btn-primary" id="addFriend">친구 추가</button>



<footer th:replace="~{fragment/footer.html::footer}"></footer>
<script>
    $(document).ready(function() {
        // 삭제 버튼 클릭 시
        $('.table').on('click', '.btn-warning', function() {
            var nickname = $(this).closest('tr').find('th').text(); // 친구 ID 가져오기
            var row = $(this).closest('tr'); // 삭제할 행 가져오기

            // 서버에 Ajax 요청 보내기
            $.ajax({
                type: 'DELETE',
                url: '/user/friend_del/'+{memberIdx}+'?friendsNickname=' + nickname,
                success: function(result) {
                    // 서버에서 친구 정보를 삭제한 후, 행을 삭제
                    row.remove();
                },
                error: function(xhr, status, error) {
                    // Ajax 요청이 실패한 경우 에러 메시지 출력
                    console.log('Error:', error);
                }
            });
        });
    });


    $(document).ready(function() {
        // 친구 추가 버튼 클릭 시
        $('#addFriend').on('click', function() {
            // 서버에 Ajax 요청 보내기
            $.ajax({
                type: 'POST',
                url: '/user/friend_add/' + {memberIdx}, // 친구 추가 경로
                success: function(result) {
                    // 친구 추가 성공 시, 메시지 출력 및 페이지 새로고침
                    location.reload();
                },
                error: function(xhr, status, error) {
                    // Ajax 요청이 실패한 경우 에러 메시지 출력
                    console.log('Error:', error);
                }
            });
        });
    });
</script>
</body>

</html>
<!DOCTYPE html>
<html
        lang="ko"
        xmlns:th="http://www.thymeleaf.org"
>
<head th:insert="~{fragment/topMenu.html::header}">
  <link rel="stylesheet" href="/css/login.css"/>
</head>
<body class="diary-write-body">

<header th:insert="~{fragment/topMenu.html::nav}"/>

<div class="container diary-container">
  <div class="">
    <div class="card-header BoxTitle text-center">
      다 이 어 리 쓰 기
    </div>

    <form class="" th:action="@{diary/write_pro}" method="post" th:object="${writeDiaryBean}"
          th:onsubmit="return false">

      <div class="row diary-write">

        <div class="card-body diary col-6">
          <div class="form-group">
            <label class="writeTitle">일기 작성</label>
          </div>

          <div class="form-group public-check-box">
            <!--                 member의 다이어리 작성 공개/비공개 여부 라디오 버튼-->
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="inlineRadioOptions" id="publicRadio1"
                     th:value="true" th:field="*{diaryPublicable}">
              <label class="form-check-label" for="publicRadio1">공개</label>
            </div>

            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="inlineRadioOptions" id="publicRadio2"
                     th:value="false" th:field="*{diaryPublicable}">
              <label class="form-check-label" for="publicRadio2">비공개</label>
            </div>

          </div>


          <div class="form-group">
            <input type="text" class="card-title diarySubject" placeholder="제목을 입력해주세요."
                   th:field="*{diarySubject}"/>
          </div>


          <div class="form-group">
                    <textarea class="card-text diaryContent" id="diaryContent" placeholder="일기내용을 작성해주세요."
                              th:field="*{diaryContent}"/>
          </div>

          <div class="form-group diaryWriteBtn">
            <input type="button" id="englishBtn" name="englishBtn" onclick="translation()"
                   value="영번역" class="btn btn-secondary englishBtn"/>
            <input type="reset" id="diaryResetBtn" name="diaryResetBtn"
                   value="재작성" class="btn btn-secondary diaryResetBtn"/>
            <input type="button" id="diarySaveBtn" name="diarySaveBtn" onclick="diarySave()"
                   value="저장" class="btn btn-secondary diarySaveBtn btn-right"/>
          </div>

          <!--                키워드-->
          <div class="form-group">
            <label>키워드</label>
            <p class="diary-keywords">
              <th:block th:each="keyword : ${diaryKeywords }">
                <button th:value="${keyword}" th:text="${keyword}"
                        th:field="*{diaryKeywords}" onclick="keywordClick()"/>
              </th:block>
            </p>
          </div>
        </div>
        <!-- 다이어리 제목부터 키워드까지 -->

        <div class="card-body Analyze diary col-6" id="Analyze" name="Analyze">
          <div class="form-group">
            <label>감정 분석</label>
          </div>

          <div class="form-group public-check-box">

            <!--                    감정분석결과 공개/비공개 라디오버튼-->
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="inlineRadioOptions" id="diaryAnalyzeRadio1"
                     th:value="true" th:field="*{diaryAnalyzePublicable}">
              <label class="form-check-label" for="diaryAnalyzeRadio1">공개</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="inlineRadioOptions" id="diaryAnalyzeRadio12"
                     th:value="false" th:field="*{diaryAnalyzePublicable}">
              <label class="form-check-label" for="diaryAnalyzeRadio1">비공개</label>
            </div>
          </div>

          <div class="form-group">
            <label class="writeTitle">감정 분석 결과</label>
          </div>

          <div class="form-group">
                    <textarea class="diaryAnalyze" th:readonly="readonly" id="diaryAnalyze"
                              th:field="*{diaryAnalyze}">건상님 감정상태가 점점 좋아지고 있어요~</textarea>
          </div>


          <input type="submit" class="btn btn-dark btn-right" value="완료"/>
        </div>
      </div>
    </form>
  </div>
</div>


<footer th:insert="~{fragment/footer.html::footer}"/>
<script>


  const diaryContent = document.getElementById('diaryContent');

  function translation() {
    //영번역 함수
  }

  function diarySave() {
    //다이어리 저장 함수
    const diarycontent = document.getElementById('diaryContent');
    let msg = diarycontent.value;
    msg += "\n위 일기에서 키워드를 단어로 나열해주고 그리고 위 일기의 감정분석해서" +
        " 조언해주고 다음에 긍정적인 문장과 부정적인 문장의 개수도 알려주는데 개수는 정수로 알려줘요.";
    console.log(msg);

    let diaryAnalyze = document.getElementById('diaryAnalyze');
    diaryAnalyze.value = "일기를 분석 중입니다.";

    let gptData = {
      method: 'POST',
      body: JSON.stringify({msg}),
      headers: {
        'Content-Type': 'application/json'
      }
    }

    fetch('http://localhost:8080/send', gptData)
        .then((response) => response.json())
        .then((data) => {
          console.log(data.data);
          let diaryAnalyze = document.getElementById('diaryAnalyze');
          const resMsg = data.data;
          diaryAnalyze.value = resMsg;
        })
  }

  function keywordClick() {
    //키워드 클릭 함수
  }

</script>
</body>
</html>
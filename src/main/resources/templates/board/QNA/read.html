<!doctype html>
<html
        lang="ko"
        xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
        xmlns:th="http://www.thymeleaf.org"
>
<head th:insert="~{fragment/topMenu.html::header}">
    <!-- 반응형 웹 미디어쿼리 선언부   -->
    <meta content="width=device-width, initial-scale=1" name="viewport">

    <script>
        // jQuery와 AJAX를 이용한 코드
        $(document).ready(function() {
            // 수정 버튼 클릭 시
            $("#editBtn").click(function() {
                // 답변 버튼과 textarea 활성화
                $("#answerBtn").prop("disabled", false);
                $("#qnaAnswer").prop("readonly", false);
            });

            var data = {
                qnaIsanswered : true
            };

            // 답변 버튼 클릭 시
            $("#answerBtn").click(function() {
                // textarea에 적은 내용을 가져와서 AJAX 요청
                var qnaAnswer = $("#qnaAnswer").val();
                $("#qnaAnswer").innerText=qnaAnswer;

                $.ajax({
                    url: "/board/qna/answer/{qnaIdx}",
                    type: "POST",
                    data: data,
                    success: function() {
                        // 답변 버튼과 textarea 비활성화
                        $("#answerBtn").prop("disabled", true);
                        $("#qnaAnswer").prop("readonly", true);
                    },
                    error: function() {
                        alert("답변 등록에 실패했습니다.");
                    }
                });
            });
        });

    </script>
</head>
<body class="p-3 m-0 border-0 bd-example qnaReadForm">
<header th:insert="~{fragment/topMenu.html::nav}"></header>

<form enctype="multipart/form-data" action="#" th:object="${qnaBean}">
    <div class="mb-3">
        <input class="form-control" id="qnaSubject" name="qnaSubject" th:text="${qnaBean.qnaSubject}" readonly
               th:field="*{qnaSubject }" type="text">
    </div>

    <div class="mb-3">
        <input class="form-control" id="qnaDate" name="qnaDate" readonly
               th:text="${#temporals.format(#qnaBean.qnaDate,'yyyy-mm-dd')}" type="text">
    </div>
    <div class="mb-3">
        <textarea class="form-control" id="qnaContent " name="qnaContent" placeholder="공지내용" readonly
                  rows="5" th:field="*{qnaContent }">
        </textarea>
    </div>

<!--    파일 어떻게 읽어오는지 생각 해 봐야함-->
    <div class="mb-3">
        <label class="form-label" for="qnaFile">첨부파일</label>
        <input class="form-control form-control-sm" id="qnaFile" name="qnaFile"  readonly
               th:field="*{qnaFile}" type="file">
    </div>

<!-- 운영자 답변 -->
    <div class="card-header bg-light">
        운영자 답변
    </div>

    <div class="card-body">
        <ul class="list-group list-group-flush">
            <li class="list-group-item">
                <textarea class="form-control" id="qnaAnswer" th:field="*{qnaAnswer}" rows="3" readonly
                          placeholder="답변 대기 중 입니다."></textarea>
                <button type="button" class="btn btn-dark mt-3" id="answerBtn" sec:authorize="hasAnyRole('ROLE_ADMIN')"
                        onclick="answer();" disabled>답변</button>
            </li>
        </ul>
    </div>


    <button class="btn btn-primary" sec:authorize="hasAnyRole('ROLE_ADMIN')" type="submit">수정</button>
    <button class="btn btn-primary" sec:authorize="hasAnyRole('ROLE_ADMIN')" type="button"
            onclick="location.href='/board/QNA/delete/{qnaIdx}'">삭제</button>
    <button class="btn btn-primary" onclick="history.go(-1)" type="button">목록</button>
</form>


</body>
</html>